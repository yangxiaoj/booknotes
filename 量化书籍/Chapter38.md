# 从零学量化38—策略相对基准的评价一（使用empyrical和quantstats库） 

在前面几篇文章中，我们介绍了《策略的收益评价》、《策略的风险评价》、以及《风险调整后的收益评价》。本节我们介绍策略相对基准的评价，本节的篇幅比较长，因此分成2篇来讲。

在投资领域，基准（Benchmark）是一种衡量投资策略表现的重要工具，它通常是一种指数或者其他可投资的资产组合，如沪深300指数，可以代表某一特定市场或者资产类别的性能。通过对比投资策略的回报和基准的回报，投资者可以明确地了解该策略是否超过了市场平均水平，或者是否达到了预期的投资目标。基准不仅可以用来衡量策略的相对收益，也可以用来衡量策略的相对风险。例如，如果投资策略的波动性（风险）比基准高，但其收益并未超过基准，那么投资者可能会认为这种策略的风险调整后的收益并不理想。通过对比基准的表现，投资者可以检验自己的投资策略是否有效。如果一种投资策略长期无法超过基准的表现，那么投资者可能需要重新考虑其投资策略的有效性。

本文介绍策略相对基准的评价和可视化分析，包括超额收益、年化超额收益率、超额收益最大回撤、信息比率（Information Ratio）、阿尔法（Alpha）、贝塔（Beta）和特雷诺比率（Treynor Ratio）等。

本文的例子来自《量化回测实例：可转债低转股溢价率策略》，为了节省篇幅，不再重复策略的实现代码，策略代码参见上文。本文使用empyrical库和quantstats库来计算评价指标和进行可视化分析，借助empyrical和quantstats这些优秀的开源量化工具库，即便是初学者也能快捷的计算各项金融指标，以及绘制专业且精美的分析图表。

empyrical库和quantstats库的安装可参见《本地Python环境部署》一文。

本文的可视化分析是在 Jupyter Notebook 中完成，使用其他的Python编辑器可能会有图表显示问题。

在使用empyrical库和quantstats库之前，我们需要先导入这两个库：
``` python

import empyrical as ep
import quantstats as qs

```

## 01 如何选择策略比较的基准
在将策略跟基准进行比较之前，首先要选择一个适当的基准，如果基准与策略的投资领域和风格不匹配，那么就可能无法准确地衡量策略的表现，可能会误导投资者，影响投资决策。以下是一些在选择基准时需要考虑的因素：
### 1. 策略的投资领域和风格
基准应该反映投资策略的投资领域和风格。比如，如果你的策略主要投资大盘股，那么沪深300指数或者其他大盘股指数可能会是一个合适的基准。又如，本文的例子是可转债投资策略，因此选择可转债等权指数作为比较基准。
### 2. 基准的广泛接受程度
在投资界，一些基准由于其广泛的使用和接受程度，可以提供一个公认的性能比较标准。例如，对于大盘股策略，沪深300指数通常被认为是一个好的基准，因为它广泛被用来衡量大型股票投资的表现。
### 3.基准的透明性
基准应该是透明的，投资者应该能够清楚地了解基准的构成和计算方式。这样，投资者可以更好地理解策略的表现和基准的差异。

## 02 策略相对基准的评价指标
### 1.超额收益和年化超额收益
超额收益是投资策略的收益超过某一基准指数的部分。这个基准指数通常代表了某一市场或者某一资产类别的平均表现。以一个具体的例子来说，假设你的投资策略在一年内实现了10%的收益，而基准指数（比如沪深300指数）在同一期间实现了8%的收益。在这种情况下，你的策略的超额收益就是2%。这意味着，你的策略在一年内比市场平均水平多赚了2%。

而年化超额收益是将超额收益转化为年化形式，使得我们可以比较不同期限的投资策略。

以下代码用empyrical库的cum_returns_final函数计算超额收益率：

``` python

ep.cum_returns_final(returns=results_df['月收益率_超额收益'])

```
以下代码用empyrical库的annual_return函数计算年化超额收益率：

``` python

ep.annual_return(returns=results_df['月收益率_超额收益'], period='monthly')

```

在上述代码中，returns 参数为收益率序列，跟收益评价指标不同的是这里的收益率序列是超额收益的收益率；period 参数为收益率序列的频率，用于计算年化值。由于本策略的收益率序列是月频的，因此该参数取值 'monthly'；如果策略的收益率序列是日频或周频的，该参数取值应为 'daily' 或 'weekly'，下同。

超额收益是投资者需要关注的一个重要指标，因为它直接反映了投资策略的绝对盈利能力。一个高超额收益的策略表明其在实现了超过市场平均表现的收益，同时也暗示了该策略可能具有一定的优秀选股或择时能力。
### 2.超额收益的最大回撤
超额收益的最大回撤帮助投资者评估投资策略相对于基准的风险性。超额收益最大回撤是在超额收益的历史表现中，从最高点到最低点的最大下降幅度。它衡量的是投资策略在超额收益方面的最大潜在损失。

可以用empyrical库的max_drawdown函数计算超额收益的最大回撤：
``` python

ep.max_drawdown(returns=results_df['月收益率_超额收益'])

```

超额收益最大回撤是一个重要的风险度量指标，它衡量的是投资策略相对于基准的风险性。一个较高的超额收益最大回撤意味着在过去，投资策略有过一段时间表现明显低于基准，这可能是由于投资策略的选股或择时决策不当，或者是由于市场环境的急剧变化。
### 3.信息比率（Information Ratio）
信息比率是策略的超额收益与超额风险之比，超额收益是指策略的收益超过基准的部分，超额风险则是策略收益的波动性与基准收益波动性的差值。信息比率衡量的是投资策略的风险调整后的超额收益，即在承受一定风险的情况下，策略能够产生多少超额收益。信息比率的计算公式为：

信息比率 = 策略超额收益的平均值 / 策略超额收益的标准差

可以用quantstats库的information_ratio函数计算信息比率：

``` python

qs.stats.information_ratio(returns=results_df['月收益率'], benchmark=results_df['月收益率_基准'])

```
上述代码中 returns 参数为策略的收益率序列，benchmark 参数为基准的收益率序列。

信息比率是一个重要的投资性能度量指标。信息比率越高，表明策略产生超额收益的能力越强，风险调整后的性能越好。换句话说，一个高信息比率的策略在承受一定风险的前提下，能够产生更高的超额收益。由于信息比率考虑了策略的超额收益和超额风险，因此它提供了一个风险调整后的性能度量，可以帮助投资者更全面地评估和比较策略的性能。
（未完待续……）