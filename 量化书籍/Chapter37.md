# 从零学量化37—策略风险调整后的收益评价（使用empyrical和quantstats库）
在前面的文章中，《策略的收益评价》与《策略的风险评价》两篇分别从收益与风险的角度对量化策略进行了独立的评估。那么，是否存在一种评价指标能够将这两个维度有效结合，从而实现对投资策略的全面评价？答案是肯定的，这就是我们称之为风险调整后的收益，换句话说，就是在接受一定风险的前提下，我们能够获取多少的收益。

本文将重点介绍这些风险调整后的收益评价指标，包括夏普比率（Sharpe Ratio）、索提诺比率（Sortino Ratio）、卡玛比率（Calmar Ratio）以及欧米茄比率（Omega Ratio）。这些指标从各自的角度量化了投资策略的风险与收益之间的关系，为投资者提供了更为全面且深入的决策参考，帮助他们更好地理解并评估投资策略的整体性能。

本文的例子来自《量化回测实例：可转债低转股溢价率策略》，为了节省篇幅，不再重复策略的实现代码，策略代码参见上文。本文使用empyrical库和quantstats库来计算评价指标和进行可视化分析，借助empyrical和quantstats这些优秀的开源量化工具库，即便是初学者也能快捷的计算各项金融指标，以及绘制专业且精美的分析图表。

empyrical库和quantstats库的安装可参见《本地Python环境部署》一文。

本文的可视化分析是在 Jupyter Notebook 中完成，使用其他的Python编辑器可能会有图表显示问题。

在使用empyrical库和quantstats库之前，我们需要先导入这两个库：

``` python

import empyrical as ep
import quantstats as qs

```
## 01 风险调整后的收益评价指标
1.夏普比率（Sharpe Ratio）
夏普比率是由诺贝尔经济学奖得主威廉·夏普提出的一种评价投资策略性能的指标。其主要功能是衡量投资者每承受一单位总风险，可以获得多少超额回报。此处的“超额”指的是超过无风险收益的部分。夏普比率的计算公式是：
夏普比率 = (Rp - Rf) / σp
其中：

- Rp 代表投资策略的预期收益率
- Rf 代表无风险收益率，通常可以采用国债的年利率或者存款利率作为参考
- σp 代表投资策略的收益的标准差，用来衡量投资策略的风险性。标准差越大，投资策略的风险性越高。

在上述计算公式中，Rp - Rf 是投资策略的超额收益，即投资策略的预期收益与无风险收益之差，这直接反映了投资策略的盈利能力。σp 是投资策略的收益的标准差，它作为风险的度量，反映了投资策略收益的波动性，波动性越大，风险越高。

夏普比率的分子部分代表了投资策略的收益，分母部分代表了投资策略的风险。当我们计算夏普比率时，我们实际上是在查看每单位风险能带来多少的超额收益。因此，夏普比率考虑了收益和风险这两个维度，是一个风险调整后的收益评价指标。夏普比率越高，表示单位风险所能获得的超额收益越高，投资策略的性能越好。

可以用empyrical库的sharpe_ratio函数计算夏普比率：

``` python

ep.sharpe_ratio(returns=results_df['月收益率'], period='monthly')

```
上述代码中 returns 参数为收益率序列，本例中 results_df['月收益率'] 为策略的每月收益率序列；period 参数为收益率序列的频率，由于本策略的收益率序列是月频的，因此该参数取值 'monthly'；如果策略的收益率序列是日频或周频的，该参数取值应为 'daily' 或 'weekly'，下同。

我们还可以计算滚动夏普比率，滚动夏普比率是在一个设定的时间窗口滚动计算的夏普比率，滚动夏普比率可以观察不同时间段内投资组合风险调整后收益的变化情况。如果夏普比率随时间增大,说明投资组合的风险调整后收益在提高。

可以用empyrical库的roll_sharpe_ratio函数计算滚动夏普比率：
``` python

ep.roll_sharpe_ratio(arr=results_df['月收益率'], window=6,  period='monthly')

```

