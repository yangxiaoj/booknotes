# 从零学量化36—策略的风险评价（使用empyrical和quantstats库） 
在上一节《策略的收益评价》我们介绍了如何从收益的角度去评价一个投资策略，但仅评价收益是不够的，因为高收益往往伴随着高风险。在量化投资中，对投资策略的风险评价是至关重要的。通过对投资策略的风险进行量化评估，我们可以了解策略可能带来的潜在损失，从而更好地管理风险。在本文中，我们将详细介绍几种常用的风险评价指标，并探讨如何通过可视化分析进行策略风险的评估。

本文的例子来自《量化回测实例：可转债低转股溢价率策略》，为了节省篇幅，不再重复策略的实现代码，策略代码参见上文。本文使用empyrical库和quantstats库来计算评价指标和进行可视化分析，借助empyrical和quantstats这些优秀的开源量化工具库，即便是初学者也能快捷的计算各项金融指标，以及绘制专业且精美的分析图表。

empyrical库和quantstats库的安装可参见《本地Python环境部署》一文。

本文的可视化分析是在 Jupyter Notebook 中完成，使用其他的Python编辑器可能会有图表显示问题。

在使用empyrical库和quantstats库之前，我们需要先导入这两个库：

``` python

import empyrical as ep
import quantstats as qs

```
## 01 风险评价的指标
### 1. 最大回撤
最大回撤是一种常见的风险度量，用于衡量投资策略在最坏的情况下可能发生的最大损失。它是通过计算投资策略从一次最高峰值下跌到之后的最低点的百分比来量化的。这是一个非常重要的指标，因为它可以帮助我们理解在极端不利条件下投资可能的下跌幅度。最大回撤越大，说明投资策略在面临逆境时的风险越高，反之则说明该策略的风险程度较低。

计算最大回撤的公式如下：

最大回撤 =（策略最高价 - 策略最低价）/ 策略最高价

这里的“策略最高价”指的是投资策略在考虑的时间范围内的最高价值，而“策略最低价”则是从最高价之后到结束日期内的最低价值。

例如，如果一种投资策略的最高价值是100元，然后下跌到60元，那么最大回撤就是40%。

可以用empyrical库的max_drawdown函数计算最大回撤：

``` python

ep.max_drawdown(returns=results_df['月收益率'])

```
上述代码中 returns 参数为收益率序列，本例中 results_df['月收益率'] 为策略的每月收益率序列，下同。
除了最大回撤，我们还可以用quantstats库的drawdown_detail函数列出回测期间的各次回撤的详细数据，代码如下：
``` python

drawdown = qs.stats.to_drawdown_series(returns=results_df['月收益率'])  # 将投资收益率序列转换为回撤序列
qs.stats.drawdown_details(drawdown)  # 各次回撤的情况表

```
得到的结果如下：

![](images/2024-02-04-17-58-00.png)

